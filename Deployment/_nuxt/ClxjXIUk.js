import{_ as ie}from"./DvbJHzoT.js";import ue from"./CKiQePng.js";import{s as re}from"./BRdF-67k.js";import de from"./D5dEUUeo.js";import{h as ce,s as me,r as o,l as pe,m as ve,c as C,a as t,t as r,f as ge,j as D,p as fe,u as l,i as c,v as be,n as he,g as z,d as N,b as V,w as I,o as b,q as F,x as G,k as H}from"./BIiSuWQy.js";import{_ as _e}from"./BnF6RBIy.js";import{_ as J,a as K}from"./Db7K3FyH.js";import{u as O}from"./DTPoL5BM.js";import{u as ye,r as we}from"./DXutHP6I.js";import{t as ke}from"./B46xxYQD.js";import"./CtjOk6qh.js";import"./DoJIvDNh.js";import"./BVSVTkE6.js";import"./Ck64r5lq.js";const $e={class:"container"},Te={class:"auth-layout flex-column"},Ae={class:"main-title bold lg mb-5"},Se={class:"layout-form md custom-width"},Ce={class:"row"},De={class:"col-12 col-md-10 mr-auto"},Ne={class:"main-title lg mb-4"},Ve={class:"form-group"},Ie={class:"label"},Ue=["placeholder"],xe={key:0,class:"form-group"},je={class:"label"},ze={class:"main_input with_icon"},Pe=["type","placeholder"],Me={class:"section-btns mt-5 justify-content-start"},Be=["disabled"],Le={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},qe={class:"new-sign mt-4 text-start"},Ee={class:"text-center"},Re={class:"section-btns mt-4 mb-4"},Fe={class:"text-center"},Ge={class:"section-btns mt-4 mb-5"},He={class:"typeSection salla"},Je={class:"typeSection zid"},Ke={class:"form-group"},Oe={class:"card flex justify-content-center dropdown_card"},Qe=["disabled"],We={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ms={__name:"login",setup(Xe){const{t:m}=ce(),{user:U,token:P}=me(O()),h=o(!1),i=o(null),g=o(!1),{response:M}=we(),{successToast:x,errorToast:n}=ke(),$=ye(),j=o({DeviceId:"Test",DeviceType:"Test",ProjectName:"barwasah"}),_=o(null),y=o(!1),f=o(!1),w=o([]),Q=O(),{signInHandler:W}=Q,d=o(!1),p=o([]),X=o(null);o("");const k=o(""),T=o(""),A=o(!1),S=o(!1),B=()=>{let s=document.querySelectorAll(".validInputs");for(let e=0;e<s.length;e++)s[e].value===""&&p.value.push(m(`validation.${s[e].getAttribute("valid")}`))},L=()=>{console.log("Selected type:",i.value),h.value=!1,i.value&&(S.value=!0)},Y=async()=>{if(p.value=[],d.value=!0,B(),p.value.length){d.value=!1,n(p.value[0]);return}try{const s=await $.get(`/CheckEmail?email=${k.value}`);s.data.key==="success"?(x(m("validation.right_email")),s.data.hasTwoAccounts?(h.value=!0,i.value=null):S.value=!0):n(s.data.message)}catch(s){s.response&&s.response.status===400?n(s.response.data.message):n(m("messages.something_wrong"))}finally{d.value=!1}},Z=async()=>{var s,e;if(!S.value){Y();return}if(d.value=!0,p.value=[],B(),p.value.length){d.value=!1,n(p.value[0]);return}try{const v={email:k.value,password:T.value,accountType:i.value||0,device:{DeviceId:j.value.DeviceId,DeviceType:j.value.DeviceType,ProjectName:j.value.ProjectName}},u=await $.post("/Login",v);u.data.statusCode===200&&u.data.key==="success"&&(x(u.data.message),await W(u.data),u.data.hasNiche?H("/"):f.value=!0)}catch(v){n(((e=(s=v==null?void 0:v.response)==null?void 0:s.data)==null?void 0:e.message)||m("messages.something_wrong"))}finally{d.value=!1}},ee=()=>{A.value=!A.value},se=pe(()=>A.value?"text":"password");ve(f,s=>{s&&te()});const te=async()=>{try{const s=await $.get("/GetNiche");M(s)==="success"?w.value=s.data.data:n(s.data.msg)}catch(s){console.error(s),n(m("messages.something_wrong"))}finally{}},ae=async()=>{if(y.value=!0,!_.value){y.value=!1,n(m("يرجى اختيار القطاع اولا"));return}try{const s=await $.post(`/SelectNiche?userId=${U.value.id}&nicheId=${_.value.id}`);M(s)==="success"?(f.value=!1,x(s.data.message),y.value=!1,U.value=s.data.data,P.value=s.data.data.token,console.log(U.value,"user Dataaaa",P.value),H("/")):n(s.data.message)}catch(s){console.error(s),n(m("messages.something_wrong"))}finally{y.value=!1}},q=s=>{window==null||window.open(s,"_blank")};return(s,e)=>{const v=ie,u=ue,le=re,oe=de;return b(),C("div",$e,[t("div",Te,[t("h1",Ae,r(s.$t("Auth.welcome")),1),t("div",Se,[e[14]||(e[14]=t("img",{src:_e,alt:"logo",class:"Auth-logo mb-4"},null,-1)),t("form",{onSubmit:ge(Z,["prevent"]),ref_key:"loginForm",ref:X},[t("div",Ce,[t("div",De,[t("h2",Ne,r(s.$t("Auth.register_store")),1),t("div",Ve,[t("label",Ie,r(s.$t("Auth.email")),1),D(t("input",{type:"email",class:"main_input validInputs",valid:"email",name:"email","onUpdate:modelValue":e[0]||(e[0]=a=>c(k)?k.value=a:null),placeholder:s.$t("Auth.enter_email")},null,8,Ue),[[fe,l(k)]])]),l(S)?(b(),C("div",xe,[t("label",je,r(s.$t("Auth.password")),1),t("div",ze,[D(t("input",{type:l(se),class:"custum-input-icon validInputs",valid:"password",name:"password","onUpdate:modelValue":e[1]||(e[1]=a=>c(T)?T.value=a:null),placeholder:s.$t("Auth.enter_password")},null,8,Pe),[[be,l(T)]]),t("button",{class:he(["static-btn with_eye",{active_class:l(A)}]),type:"button",onClick:ee},e[13]||(e[13]=[t("i",{class:"far fa-eye icon"},null,-1)]),2)])])):z("",!0),t("div",Me,[t("button",{type:"submit",class:"custom-btn sm",disabled:l(d)},[N(r(s.$t("Auth.login"))+" ",1),l(d)?(b(),C("span",Le)):z("",!0)],8,Be),t("button",{type:"button",onClick:e[2]||(e[2]=a=>g.value=!0),class:"custom-btn red-bg sm"},r(s.$t("Auth.create_account")),1)]),t("div",qe,[N(r(s.$t("Auth.forget_password"))+" ",1),V(v,{to:"restorePassword"},{default:I(()=>[N(r(s.$t("Auth.restore_password")),1)]),_:1})])])])],544)])]),V(u,{visible:l(g),"onUpdate:visible":e[5]||(e[5]=a=>c(g)?g.value=a:null),modal:"",class:"custum_dialog_width auth-daialog",draggable:!1},{default:I(()=>[t("div",Ee,[e[17]||(e[17]=t("h5",{class:"main-title sm blue mb-4"}," اختر المنصة التي ترغب في ربط متجرك بها عبر تطبيق بروزه من خلال سوق تطبيقات سلة وزد.",-1)),t("div",Re,[t("button",{onClick:e[3]||(e[3]=()=>{q("https://salla.com/"),g.value=!1}),class:"typeSection salla"},e[15]||(e[15]=[t("img",{src:J,alt:""},null,-1)])),t("button",{onClick:e[4]||(e[4]=()=>{q("https://zid.sa/"),g.value=!1}),class:"typeSection zid"},e[16]||(e[16]=[t("img",{src:K,alt:""},null,-1)]))])])]),_:1},8,["visible"]),V(u,{visible:l(h),"onUpdate:visible":e[10]||(e[10]=a=>c(h)?h.value=a:null),modal:"",class:"custum_dialog_width without-close auth-daialog",draggable:!1},{default:I(()=>[t("div",Fe,[e[20]||(e[20]=t("h5",{class:"main-title sm blue mb-4"}," يمكنك ربط متجرك مع تطبيق بروزه من خلال سوق تطبيقات سله و زد ",-1)),e[21]||(e[21]=t("h4",{class:"main-title bold mb-5"}," متجرك على أي منصة؟ ",-1)),t("div",Ge,[t("label",He,[D(t("input",{type:"radio",value:"1",name:"checkType","onUpdate:modelValue":e[6]||(e[6]=a=>c(i)?i.value=a:null),class:"d-none",onChange:e[7]||(e[7]=a=>L("salla"))},null,544),[[F,l(i)]]),e[18]||(e[18]=t("img",{src:J,alt:""},null,-1))]),t("label",Je,[D(t("input",{type:"radio",value:"2",name:"checkType","onUpdate:modelValue":e[8]||(e[8]=a=>c(i)?i.value=a:null),class:"d-none",onChange:e[9]||(e[9]=a=>L("zid"))},null,544),[[F,l(i)]]),e[19]||(e[19]=t("img",{src:K,alt:""},null,-1))])])])]),_:1},8,["visible"]),V(u,{visible:l(f),"onUpdate:visible":e[12]||(e[12]=a=>c(f)?f.value=a:null),modal:"",class:"custum_dialog_width without-close auth-daialog",draggable:!1},{default:I(()=>{var a,E,R;return[e[23]||(e[23]=t("div",{class:"text-center"},[t("h4",{class:"main-title bold mb-5"}," قم بإختيار نوع القطاع اولا ")],-1)),t("div",Ke,[e[22]||(e[22]=t("label",{class:"label"},"القطاع",-1)),t("div",Oe,[(a=l(w))!=null&&a.length?(b(),G(le,{key:0,modelValue:l(_),"onUpdate:modelValue":e[11]||(e[11]=ne=>c(_)?_.value=ne:null),display:"chip",options:l(w),optionLabel:"name",placeholder:"اختر نوع القطاع",maxSelectedLabels:(E=l(w))==null?void 0:E.length,class:"custum-dropdown"},null,8,["modelValue","options","maxSelectedLabels"])):(b(),G(oe,{key:1,width:"100%",height:"40px"}))])]),t("button",{disabled:!((R=l(w))!=null&&R.length),type:"button",class:"custom-btn sm mr-auto mb-4",onClick:ae},[N(r(s.$t("Auth.send"))+" ",1),l(y)?(b(),C("span",We)):z("",!0)],8,Qe)]}),_:1},8,["visible"])])}}};export{ms as default};
