import{_ as te}from"./BP76DtL4.js";import ae from"./F3QQJnpl.js";import{s as oe}from"./D8qqV3WI.js";import le from"./CQbogLMU.js";import{j as ne,s as ie,r as l,m as re,p as ue,c as S,a as s,t as r,h as de,k as V,q as ce,u as a,i as p,v as me,n as pe,f as x,d as k,b as D,w as I,o as f,x as L,y as q,l as E}from"./CDjVABWN.js";import{_ as ve}from"./bb58lmf1.js";import{_ as ge,a as he}from"./DrAwFmap.js";import{u as F}from"./CVjljgFj.js";import{u as fe,r as _e}from"./Bwfks3Mu.js";import{t as be}from"./CsKsy3XR.js";import"./vdJJGTyi.js";import"./GeIhuEdx.js";import"./BXjy7pqY.js";import"./BbxwispC.js";const ye={class:"container"},we={class:"auth-layout flex-column"},ke={class:"main-title bold lg mb-5"},$e={class:"layout-form md custom-width"},Te={class:"row"},Ae={class:"col-12 col-md-10 mr-auto"},Ne={class:"main-title lg mb-4"},Se={class:"form-group"},Ve={class:"label"},De=["placeholder"],Ie={key:0,class:"form-group"},Ce={class:"label"},xe={class:"main_input with_icon"},Ue=["type","placeholder"],je={class:"section-btns mt-5 justify-content-start"},Pe=["disabled"],Me={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Re={class:"new-sign mt-4 text-start"},ze={class:"text-center"},Be={class:"section-btns mt-4 mb-5"},Le={class:"typeSection salla"},qe={class:"typeSection zid"},Ee={class:"form-group"},Fe={class:"card flex justify-content-center dropdown_card"},Ge=["disabled"],He={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},is={__name:"login",setup(Je){const{t:c}=ne(),{user:G}=ie(F()),_=l(!1),i=l(null),{response:U}=_e(),{successToast:j,errorToast:n}=be(),$=fe(),C=l({DeviceId:"Test",DeviceType:"Test",ProjectName:"barwasah"}),b=l(null),y=l(!1),v=l(!1),w=l([]),H=F(),{signInHandler:J}=H,g=l(!1),m=l([]),K=l(null);l("");const h=l(""),T=l(""),A=l(!1),N=l(!1),P=()=>{let t=document.querySelectorAll(".validInputs");for(let e=0;e<t.length;e++)t[e].value===""&&m.value.push(c(`validation.${t[e].getAttribute("valid")}`))},M=()=>{console.log("Selected type:",i.value),_.value=!1,i.value&&(N.value=!0)},R=async()=>{if(m.value=[],P(),m.value.length){g.value=!1,n(m.value[0]);return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h.value)){n(c("validation.invalid_email"));return}try{const e=await $.get(`/CheckEmail?email=${h.value}`);e.data.key==="success"?e.data.hasTwoAccounts?(_.value=!0,i.value=null):N.value=!0:n(e.data.message)}catch(e){e.response&&e.response.status===400?n(e.response.data.message):n(c("messages.something_wrong"))}},O=async()=>{var t,e;if(!N.value){R();return}if(g.value=!0,m.value=[],P(),m.value.length){g.value=!1,n(m.value[0]);return}try{const u={email:h.value,password:T.value,accountType:i.value||0,device:{DeviceId:C.value.DeviceId,DeviceType:C.value.DeviceType,ProjectName:C.value.ProjectName}},d=await $.post("/Login",u);d.data.statusCode===200&&d.data.key==="success"&&(j(d.data.message),await J(d.data),d.data.hasNiche?E("/"):v.value=!0)}catch(u){n(((e=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:e.message)||c("messages.something_wrong"))}finally{g.value=!1}},Q=()=>{A.value=!A.value},W=re(()=>A.value?"text":"password");ue(v,t=>{t&&X()});const X=async()=>{try{const t=await $.get("/GetNiche");U(t)==="success"?w.value=t.data.data:n(t.data.msg)}catch(t){console.error(t),n(c("messages.something_wrong"))}finally{}},Y=async()=>{if(y.value=!0,!b.value){y.value=!1,n(c("يرجى اختيار القطاع اولا"));return}try{const t=await $.post(`/SelectNiche?userId=${G.value.id}&nicheId=${b.value.id}`);U(t)==="success"?(v.value=!1,j(t.data.message),y.value=!1,E("/")):n(t.data.message)}catch(t){console.error(t),n(c("messages.something_wrong"))}finally{y.value=!1}};return(t,e)=>{const u=te,d=ae,Z=oe,ee=le;return f(),S("div",ye,[s("div",we,[s("h1",ke,r(t.$t("Auth.welcome")),1),s("div",$e,[e[10]||(e[10]=s("img",{src:ve,alt:"logo",class:"Auth-logo mb-4"},null,-1)),s("form",{onSubmit:de(O,["prevent"]),ref_key:"loginForm",ref:K},[s("div",Te,[s("div",Ae,[s("h2",Ne,r(t.$t("Auth.register_store")),1),s("div",Se,[s("label",Ve,r(t.$t("Auth.email")),1),V(s("input",{type:"email",class:"main_input validInputs",valid:"email",name:"email","onUpdate:modelValue":e[0]||(e[0]=o=>p(h)?h.value=o:null),onInput:R,placeholder:t.$t("Auth.enter_email")},null,40,De),[[ce,a(h)]])]),a(N)?(f(),S("div",Ie,[s("label",Ce,r(t.$t("Auth.password")),1),s("div",xe,[V(s("input",{type:a(W),class:"custum-input-icon validInputs",valid:"password",name:"password","onUpdate:modelValue":e[1]||(e[1]=o=>p(T)?T.value=o:null),placeholder:t.$t("Auth.enter_password")},null,8,Ue),[[me,a(T)]]),s("button",{class:pe(["static-btn with_eye",{active_class:a(A)}]),type:"button",onClick:Q},e[9]||(e[9]=[s("i",{class:"far fa-eye icon"},null,-1)]),2)])])):x("",!0),s("div",je,[s("button",{type:"submit",class:"custom-btn sm",disabled:a(g)},[k(r(t.$t("Auth.login"))+" ",1),a(g)?(f(),S("span",Me)):x("",!0)],8,Pe),D(u,{to:"https://www.google.com/",target:"_blank",class:"custom-btn red-bg sm"},{default:I(()=>[k(r(t.$t("Auth.create_account")),1)]),_:1})]),s("div",Re,[k(r(t.$t("Auth.forget_password"))+" ",1),D(u,{to:"restorePassword"},{default:I(()=>[k(r(t.$t("Auth.restore_password")),1)]),_:1})])])])],544)])]),D(d,{visible:a(_),"onUpdate:visible":e[6]||(e[6]=o=>p(_)?_.value=o:null),modal:"",class:"custum_dialog_width without-close auth-daialog",draggable:!1},{default:I(()=>[s("div",ze,[e[13]||(e[13]=s("h5",{class:"main-title sm blue mb-4"}," يمكنك ربط متجرك مع تطبيق بروزه من خلال سوق تطبيقات سله و زد ",-1)),e[14]||(e[14]=s("h4",{class:"main-title bold mb-5"}," متجرك على أي منصة؟ ",-1)),s("div",Be,[s("label",Le,[V(s("input",{type:"radio",value:"1",name:"checkType","onUpdate:modelValue":e[2]||(e[2]=o=>p(i)?i.value=o:null),class:"d-none",onChange:e[3]||(e[3]=o=>M("salla"))},null,544),[[L,a(i)]]),e[11]||(e[11]=s("img",{src:ge,alt:""},null,-1))]),s("label",qe,[V(s("input",{type:"radio",value:"2",name:"checkType","onUpdate:modelValue":e[4]||(e[4]=o=>p(i)?i.value=o:null),class:"d-none",onChange:e[5]||(e[5]=o=>M("zid"))},null,544),[[L,a(i)]]),e[12]||(e[12]=s("img",{src:he,alt:""},null,-1))])])])]),_:1},8,["visible"]),D(d,{visible:a(v),"onUpdate:visible":e[8]||(e[8]=o=>p(v)?v.value=o:null),modal:"",class:"custum_dialog_width without-close auth-daialog",draggable:!1},{default:I(()=>{var o,z,B;return[e[16]||(e[16]=s("div",{class:"text-center"},[s("h4",{class:"main-title bold mb-5"}," قم بإختيار نوع القطاع اولا ")],-1)),s("div",Ee,[e[15]||(e[15]=s("label",{class:"label"},"القطاع",-1)),s("div",Fe,[(o=a(w))!=null&&o.length?(f(),q(Z,{key:0,modelValue:a(b),"onUpdate:modelValue":e[7]||(e[7]=se=>p(b)?b.value=se:null),display:"chip",options:a(w),optionLabel:"name",placeholder:"اختر نوع القطاع",maxSelectedLabels:(z=a(w))==null?void 0:z.length,class:"custum-dropdown"},null,8,["modelValue","options","maxSelectedLabels"])):(f(),q(ee,{key:1,width:"100%",height:"40px"}))])]),s("button",{disabled:!((B=a(w))!=null&&B.length),type:"button",class:"custom-btn sm mr-auto mb-4",onClick:Y},[k(r(t.$t("Auth.send"))+" ",1),a(y)?(f(),S("span",He)):x("",!0)],8,Ge)]}),_:1},8,["visible"])])}}};export{is as default};
