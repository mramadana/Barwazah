import{I as c,k as o,ag as l}from"./CMri8QdG.js";import{u as i,r as d}from"./DXutHP6I.js";const n=i(),{response:r}=d(),m=c("auth",{state:()=>({user:{phone:"",country_code:"",accountType:null},token:null,isLoggedIn:!1,newPhone:null,notificationToken:null,test:"test key",currentemail:null,currentPasword:null,hasTwoAccount:null,newemail:null}),actions:{async signInHandler(t){if(t.statusCode===200&&t.key==="success"){this.user=t.data,this.token=t.data.token,this.isLoggedIn=!0;const s=i();return s.defaults.headers.Authorization=`Bearer ${this.token}`,{status:"success",msg:t.message}}else return{status:"error",msg:t.message}},async signUpHandler(t){const s=await n.post("sign-up",t);return r(s)=="success"?(this.user=s.data.data,o("/Auth/activateAccount"),{status:"success",msg:s.data.msg}):{status:"error",msg:s.data.msg}},async verificationHandler(t){const s=await n.post("activate?_method=patch",t);return r(s)=="success"?(this.token=s.data.data.token,this.isLoggedIn=!0,o("/"),{status:"success",msg:s.data.msg}):{status:"error",msg:s.data.msg}},async profileHandler(t){const s={headers:{Authorization:`Bearer ${this.token}`}},e=await n.post("update-profile",t,s);return r(e)=="success"?(this.user=e.data.data,{status:"success",msg:e.data.msg}):{status:"error",msg:e.data.msg}},async phoneHandler(t,s){const e={headers:{Authorization:`Bearer ${this.token}`}},a=await n.post("change-phone-send-code",t,e);return r(a)=="success"?(this.newPhone=s,o("/mobileActivateCode"),{status:"success",msg:a.data.msg}):{status:"error",msg:a.data.msg}},async logoutHandler(){var s,e;const t={headers:{Authorization:`Bearer ${this.token}`}};try{const{data:a}=await n.post("Logout",{},t);return a.key==="success"?(this.token=null,this.user=null,this.isLoggedIn=!1,o("/Auth/login"),{status:"success",msg:a.message}):{status:"error",msg:a.message}}catch(a){return{status:"error",msg:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"An error occurred"}}},async deleteAccountHandler(){const t={headers:{Authorization:`Bearer ${this.token}`}},s=await n.post("delete-account","",t);return r(s)=="success"||r(s)=="blocked"||r(s)=="unauthenticated"?(this.token=null,this.user={phone:"",country_code:"",image:null,email:null,name:null},this.isLoggedIn=!1,{status:"success",msg:s.data.msg}):{status:"error",msg:s.data.msg}},async changeMailHandler(t,s,e){const a={headers:{Authorization:`Bearer ${this.token}`}},u=await n.post("change-email-send-code",t,a);return r(u)=="success"?(this.currentemail=s,this.currentPasword=e,o("/emailActivateCode"),{status:"success",msg:u.data.msg}):{status:"error",msg:u.data.msg}}},persist:{storage:l.cookiesWithOptions({sameSite:"strict"})}});export{m as u};
